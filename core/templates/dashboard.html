{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% load formatacao %}

{% block content %}

<div class="container-fluid dashboard-a">

  <!-- INPUT PRINCIPAL -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="post" class="quick-form">
        {% csrf_token %}
        <div class="input-group input-group-lg">
          <input
            type="text"
            name="quick_entry"
            class="form-control"
            placeholder="Ex: saÃ­da 45 uber ontem | entrada 1500 salÃ¡rio"
            autofocus
          >
          <button class="btn btn-primary px-4" type="submit">
            Enviar
          </button>
        </div>
        <small class="text-muted mt-1 d-block">
          Digite como vocÃª fala. O sistema entende sozinho.
        </small>
      </form>
    </div>
  </div>
  
<!-- KPI CARDS -->
  <div class="row g-4 mb-4">
    <div class="col-md-4">
      <div class="card kpi-card kpi-entrada">
        <div class="card-body">
          <span>Entradas</span>
          <h3>{{ entradas|moeda_br }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card kpi-card kpi-saida">
        <div class="card-body">
          <span>SaÃ­das</span>
          <h3>{{ saidas|moeda_br }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card kpi-card kpi-saldo">
        <div class="card-body">
          <span>Saldo</span>
          <h3>{{ saldo|moeda_br }}</h3>
        </div>
      </div>
    </div>
  </div>

</div>
  <!-- RESUMO -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card resumo-card success">
        <small>Entradas</small>
        <h2>{{ entradas|moeda_br }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card resumo-card danger">
        <small>SaÃ­das</small>
        <h2>{{ saidas|moeda_br }}</h2>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card resumo-card primary">
        <small>Saldo atual</small>
        <h2>{{ saldo|moeda_br }}</h2>
      </div>
    </div>
  </div>

  <!-- INSIGHT PRINCIPAL -->
  <div class="card insight mb-4">
    <div class="card-body">
      <strong>{{ humor.emoji }} {{ humor.texto }}</strong>
    </div>
  </div>

  <!-- GRÃFICO -->
  <div class="card mb-4">
    <div class="card-body">
      <h6 class="mb-3">ðŸ“ˆ EvoluÃ§Ã£o do mÃªs</h6>
      <canvas id="graficoLinha"></canvas>
    </div>
  </div>

  <!-- ÃšLTIMOS LANÃ‡AMENTOS -->
  <div class="card">
    <div class="card-body">
      <h6 class="mb-3">Ãšltimos lanÃ§amentos</h6>

      <table class="table table-sm table-hover">
        <tbody>
          {% for l in lancamentos|slice:":5" %}
          <tr>
            <td width="60">
              {% if l.tipo == 'E' %}
                <span class="badge bg-success">+</span>
              {% else %}
                <span class="badge bg-danger">âˆ’</span>
              {% endif %}
            </td>
            <td>{{ l.categoria.nome }}</td>
            <td class="text-end">{{ l.valor|moeda_br }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="text-center text-muted">
              Nenhum lanÃ§amento ainda
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>

</div>

{% if tem_grafico %}
<script>
new Chart(document.getElementById('graficoCategoria'), {
    type: 'line',
    data: {
        labels: {{ labels_categoria|safe }},
        datasets: [{
            label: 'Gastos',
            data: {{ valores_categoria|safe }},
            borderColor: '#38bdf8',
            backgroundColor: 'rgba(56,189,248,.15)',
            tension: 0.4,
            fill: true,
            pointRadius: 4,
            pointBackgroundColor: '#38bdf8'
        }]
    },

    options: {
    plugins: {
        legend: {
            display: false
        }
    },
    scales: {
        x: {
            ticks: {
                color: '#e5e7eb'
            },
            grid: {
                color: 'rgba(255,255,255,0.05)'
            }
        },
        y: {
            ticks: {
                color: '#e5e7eb'
            },
            grid: {
                color: 'rgba(255,255,255,0.08)'
            }
        }
    }
}
});
</script>

{% endif %}

{% endblock %}
