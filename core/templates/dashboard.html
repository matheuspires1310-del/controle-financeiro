{% extends "base.html" %}
{% load formatacao %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="dashboard-shell">

  <!-- =====================
       HERO Â· LANÃ‡AMENTO
  ====================== -->
  <section class="dashboard-hero">
    <form method="post" class="quick-form">
      {% csrf_token %}

      <label class="hero-label">
        ðŸ’¬ O que aconteceu com seu dinheiro hoje?
      </label>

      <div class="hero-input">
        <input
          type="text"
          name="quick_entry"
          placeholder="Ex: saÃ­da 45 uber ontem | entrada 1500 salÃ¡rio"
          autofocus
        >
        <button type="submit">Enter â†µ</button>
      </div>

      <small class="hero-hint">
        Digite como vocÃª fala. O sistema entende sozinho.
      </small>
    </form>
  </section>

  <!-- =====================
       KPI Â· RESUMO
  ====================== -->
  <section class="dashboard-kpis">
    <div class="kpi-card kpi-green">
      <span>Entradas</span>
      <strong>{{ entradas|moeda_br }}</strong>
    </div>

    <div class="kpi-card kpi-red">
      <span>SaÃ­das</span>
      <strong>{{ saidas|moeda_br }}</strong>
    </div>

    <div class="kpi-card kpi-blue">
      <span>Saldo atual</span>
      <strong>{{ saldo|moeda_br }}</strong>
    </div>
  </section>

  <!-- =====================
       INSIGHT PRINCIPAL
  ====================== -->
  <section class="dashboard-insight">
    <div class="insight-card">
      <span class="insight-emoji">{{ humor.emoji }}</span>
      <span class="insight-text">{{ humor.texto }}</span>
    </div>
  </section>

  <!-- =====================
       GRÃFICO
  ====================== -->
  {% if tem_grafico %}
  <section class="dashboard-chart">
    <header>
      <h3>ðŸ“ˆ EvoluÃ§Ã£o do mÃªs</h3>
    </header>
    <div class="chart-wrapper">
      <canvas id="graficoLinha"></canvas>
    </div>
  </section>
  {% endif %}

  <!-- =====================
       ÃšLTIMOS LANÃ‡AMENTOS
  ====================== -->
  <section class="dashboard-list">
    <header>
      <h3>Ãšltimos lanÃ§amentos</h3>
    </header>

    <table class="lancamentos-table">
      <tbody>
        {% for l in lancamentos|slice:":5" %}
        <tr>
          <td class="tipo">
            {% if l.tipo == "E" %}
              <span class="tag entrada">+</span>
            {% else %}
              <span class="tag saida">âˆ’</span>
            {% endif %}
          </td>
          <td class="categoria">
            {{ l.categoria.nome }}
          </td>
          <td class="valor">
            {{ l.valor|moeda_br }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="empty">
            Nenhum lanÃ§amento ainda
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

</div>

{% if tem_grafico %}
<script>
new Chart(document.getElementById("graficoLinha"), {
  type: "line",
  data: {
    labels: {{ labels_categoria|safe }},
    datasets: [{
      data: {{ valores_categoria|safe }},
      borderColor: "#38bdf8",
      backgroundColor: "rgba(56,189,248,0.15)",
      tension: 0.35,
      fill: true,
      pointRadius: 4,
      pointBackgroundColor: "#38bdf8"
    }]
  },
  options: {
    plugins: {
      legend: { display: false }
    },
    scales: {
      x: {
        ticks: { color: "#9ca3af" },
        grid: { display: false }
      },
      y: {
        ticks: { color: "#9ca3af" },
        grid: { color: "rgba(255,255,255,0.06)" }
      }
    }
  }
});
</script>
{% endif %}

{% load static %}
<script src="{% static 'core/js/dashboard.js' %}"></script>

{% endblock %}
