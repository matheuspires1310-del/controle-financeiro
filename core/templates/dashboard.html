{% load static %}
{% extends "base.html" %}
{% load formatacao %}

{% block title %}Painel de controle{% endblock %}

{% block content %}

<div class="dashboard-shell">

  <!-- =====================
       HERO Â· LANÃ‡AMENTO
  ====================== -->
  <section class="dashboard-hero">
    <form method="post" class="quick-form">
      {% csrf_token %}

      <label class="hero-label">
        ðŸ’¬ O que aconteceu com seu dinheiro hoje?
      </label>

      <div class="hero-input">
        <input
          type="text"
          name="quick_entry"
          placeholder="Ex: saÃ­da 45 uber ontem | entrada 1500 salÃ¡rio"
          autofocus
        >
        <button type="submit">Enter â†µ</button>
      </div>

      <small class="hero-hint">
        Digite como vocÃª fala. O sistema entende sozinho.
      </small>
    </form>
  </section>

  <!-- =====================
       KPI Â· RESUMO
  ====================== -->
  <section class="dashboard-kpis">
    <div class="kpi-card kpi-green">
      <span>Entradas</span>
      <strong>{{ entradas|moeda_br }}</strong>
    </div>

    <div class="kpi-card kpi-red">
      <span>SaÃ­das</span>
      <strong>{{ saidas|moeda_br }}</strong>
    </div>

    <div class="kpi-card kpi-blue">
      <span>Saldo atual</span>
      <strong>{{ saldo|moeda_br }}</strong>
    </div>
  </section>

  <!-- =====================
       INSIGHT PRINCIPAL
  ====================== -->
  <section class="dashboard-insight">
    <div class="insight-card">
      <span class="insight-emoji">{{ humor.emoji }}</span>
      <span class="insight-text">{{ humor.texto }}</span>
    </div>
  </section>
<!-- ================= INSIGHTS FINANCEIROS ================= -->
<div class="row g-4 mb-4">

  <!-- AÃ‡ÃƒO PRIORITÃRIA -->
  {% if acao_principal %}
  <div class="col-md-6">
    <div class="card insight-card highlight">
      <div class="card-body">
        <h6 class="mb-2">ðŸŽ¯ AÃ§Ã£o prioritÃ¡ria do mÃªs</h6>
        <p class="mb-1 fw-semibold">{{ acao_principal.titulo }}</p>
        <p class="text-muted mb-2">{{ acao_principal.descricao }}</p>
        <span class="impact">
          Impacto estimado: +R$ {{ acao_principal.impacto }}
        </span>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- PERSONALIDADE FINANCEIRA -->
  {% if personalidade %}
  <div class="col-md-6">
    <div class="card insight-card soft">
      <div class="card-body">
        <h6 class="mb-2">ðŸ§  Seu perfil financeiro</h6>
        <h5 class="mb-1">{{ personalidade }}</h5>
        <p class="text-muted mb-0">{{ descricao_personalidade }}</p>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- LEITURA INTELIGENTE -->
  {% if impacto_anual %}
  <div class="col-12">
    <div class="card insight-card info">
      <div class="card-body">
        <h6 class="mb-2">ðŸ’¡ Leitura inteligente dos gastos</h6>
        <p class="mb-2">
          Analisando seus hÃ¡bitos atuais, pequenos ajustes distribuÃ­dos podem gerar
          uma economia anual relevante sem comprometer seu estilo de vida.
        </p>
        <ul class="mb-0">
          <li>
            Economia anual estimada:
            <strong>R$ {{ impacto_anual.economia_anual|floatformat:2 }}</strong>
          </li>
          <li>
            ReduÃ§Ãµes graduais funcionam melhor que cortes bruscos.
          </li>
        </ul>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- IMPACTO ANUAL -->
  {% if impacto_anual %}
  <div class="col-12">
    <div class="card insight-card success">
      <div class="card-body">
        <h6 class="mb-3">ðŸ“† ProjeÃ§Ã£o anual</h6>
        <div class="row text-center">
          <div class="col-md-4">
            <small class="text-muted">Gasto atual</small>
            <h5 class="text-danger">
              R$ {{ impacto_anual.gasto_atual|floatformat:2 }}
            </h5>
          </div>
          <div class="col-md-4">
            <small class="text-muted">Com ajustes</small>
            <h5 class="text-success">
              R$ {{ impacto_anual.gasto_ajustado|floatformat:2 }}
            </h5>
          </div>
          <div class="col-md-4">
            <small class="text-muted">Economia</small>
            <h4 class="fw-bold text-success">
              R$ {{ impacto_anual.economia_anual|floatformat:2 }}
            </h4>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>
<!-- ======================================================== -->

  <!-- =====================
       GRÃFICO
  ====================== -->
  {% if tem_grafico %}
  <section class="dashboard-chart">
    <header>
      <h3>ðŸ“ˆ EvoluÃ§Ã£o do mÃªs</h3>
    </header>
    <div class="chart-wrapper">
      <canvas id="graficoLinha"></canvas>
    </div>
  </section>
  {% endif %}

  <!-- =====================
       ÃšLTIMOS LANÃ‡AMENTOS
  ====================== -->
  <section class="dashboard-list">
    <header>
      <h3>Ãšltimos lanÃ§amentos</h3>
    </header>

    <table class="lancamentos-table">
      <tbody>
        {% for l in lancamentos|slice:":5" %}
        <tr>
          <td class="tipo">
            {% if l.tipo == "E" %}
              <span class="tag entrada">+</span>
            {% else %}
              <span class="tag saida">âˆ’</span>
            {% endif %}
          </td>
          <td class="categoria">
            {{ l.categoria.nome }}
          </td>
          <td class="valor">
            {{ l.valor|moeda_br }}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="empty">
            Nenhum lanÃ§amento ainda
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

</div>

{% if tem_grafico %}
<script>
  window.labelsCategoria = {{ labels_categoria|safe }};
  window.valoresCategoria = {{ valores_categoria|safe }};
</script>
{% endif %}

{% block extra_js %}
<script src="{% static 'core/js/dashboard.js' %}"></script>


{% endblock %}


