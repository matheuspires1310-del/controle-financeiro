{% extends "base.html" %}
{% load static %}
{% load formatacao %}

{% block title %}Painel de controle{% endblock %}

{% block content %}

<div class="dashboard-shell">
    
  <!-- ===== HERO (quick entry) ===== -->
<section class="dashboard-hero container-fluid py-4">
  <div class="hero-wrapper card">
    <div class="card-body">
      <form method="post" class="quick-form d-flex align-items-start gap-3">
        {% csrf_token %}
        <div class="hero-meta w-100">
          <label class="hero-label mb-2">ðŸ’¬ O que aconteceu com seu dinheiro hoje?</label>
          <div class="hero-input d-flex gap-2">
            <input
              type="text"
              name="quick_entry"
              class="form-control hero-field"
              placeholder="Ex: saÃ­da 45 uber ontem | entrada 1500 salÃ¡rio"
              autocomplete="off"
              autofocus
            >
            <button class="btn btn-primary hero-btn" type="submit">Enter â†µ</button>
          </div>
          <small class="hero-hint d-block mt-2">Digite como vocÃª fala. O sistema entende sozinho.</small>
        </div>
      </form>
    </div>
  </div>
</section>

<!-- ===== KPI CARDS ===== -->
<section class="container-fluid mt-4">
  <div class="dashboard-kpis">
    <div class="kpi-card kpi-green card">
      <div class="card-body">
        <span class="kpi-label">Entradas</span>
        <strong class="kpi-value">{{ entradas|moeda_br }}</strong>
      </div>
    </div>

    <div class="kpi-card kpi-red card">
      <div class="card-body">
        <span class="kpi-label">SaÃ­das</span>
        <strong class="kpi-value">{{ saidas|moeda_br }}</strong>
      </div>
    </div>

    <div class="kpi-card kpi-blue card">
      <div class="card-body">
        <span class="kpi-label">Saldo</span>
        <strong class="kpi-value">{{ saldo|moeda_br }}</strong>
      </div>
    </div>
  </div>
</section>

<div class="row g-4 mb-4">

  <!-- COLUNA ESQUERDA -->
  <div class="col-lg-8 d-flex flex-column gap-4">

    {% if acao_principal %}
    <div class="card insight-card highlight">
      <div class="card-body">
        <h6 class="mb-2">ðŸŽ¯ AÃ§Ã£o prioritÃ¡ria do mÃªs</h6>
        <p class="mb-1 fw-semibold">{{ acao_principal.titulo }}</p>
        <p class="text-muted mb-2">{{ acao_principal.descricao }}</p>
        <span class="impact">
          Impacto estimado:  {{ acao_principal.impacto|moeda_br }}
        </span>
      </div>
    </div>
    {% endif %}

    {% if personalidade %}
    <div class="card insight-card soft">
      <div class="card-body">
        <h6 class="mb-2">ðŸ§  Seu perfil financeiro</h6>
        <h5 class="mb-1">{{ personalidade }}</h5>
        <p class="text-muted mb-0">{{ descricao_personalidade }}</p>
      </div>
    </div>
    {% endif %}

  </div>

  <!-- COLUNA DIREITA -->
  <div class="col-lg-4">
    <div class="card insight-card soft h-100">
      <div class="card-body">
        <h6 class="mb-3">ðŸ“‹ Ãšltimos lanÃ§amentos</h6>

        <ul class="ultimos-list">
          {% for l in lancamentos|slice:":5" %}
          <li class="{% if l.tipo == 'E' %}in{% else %}out{% endif %}">
            <span>{{ l.categoria.nome }}</span>
            <strong>{{ l.valor|moeda_br }}</strong>
          </li>
          {% endfor %}
        </ul>

      </div>
    </div>
  </div>

</div>

  <!-- LEITURA INTELIGENTE -->
  {% if impacto_anual %}
  <div class="col-12">
    <div class="card insight-card info">
      <div class="card-body">
        <h6 class="mb-2">ðŸ’¡ Leitura inteligente dos gastos</h6>
        <p class="mb-2">
          Analisando seus hÃ¡bitos atuais, pequenos ajustes distribuÃ­dos podem gerar
          uma economia anual relevante sem comprometer seu estilo de vida.
        </p>
        <ul class="mb-0">
          <li>
            Economia anual estimada:
            <strong> {{ impacto_anual.economia_anual|moeda_br }}</strong>
          </li>
          <li>
            ReduÃ§Ãµes graduais funcionam melhor que cortes bruscos.
          </li>
        </ul>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- IMPACTO ANUAL -->
  {% if impacto_anual %}
  <div class="col-12">
    <div class="card insight-card success">
      <div class="card-body">
        <h6 class="mb-3">ðŸ“† ProjeÃ§Ã£o anual</h6>
        <div class="row text-center">
          <div class="col-md-4">
            <small class="text-muted">Gasto atual</small>
            <h5 class="text-danger">
               {{ impacto_anual.gasto_atual|moeda_br }}
            </h5>
          </div>
          <div class="col-md-4">
            <small class="text-muted">Com ajustes</small>
            <h5 class="text-success">
               {{ impacto_anual.gasto_ajustado|moeda_br }}
            </h5>
          </div>
          <div class="col-md-4">
            <small class="text-muted">Economia</small>
            <h4 class="fw-bold text-success">
               {{ impacto_anual.economia_anual|moeda_br }}
            </h4>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>
<!-- ======================================================== -->
<form method="get" class="mb-3">
  <select name="periodo" onchange="this.form.submit()" class="form-select w-auto">
    <option value="mes" {% if periodo == "mes" %}selected{% endif %}>MÃªs</option>
    <option value="semana" {% if periodo == "semana" %}selected{% endif %}>Semana</option>
  </select>
</form>

  <!-- =====================
       GRÃFICO
  ====================== -->
  {% if tem_grafico %}
  <section class="dashboard-chart">
    <header>
      <h3>ðŸ“ˆ EvoluÃ§Ã£o do mÃªs</h3>
    </header>
    <div class="chart-wrapper">
      <canvas id="graficoLinha"></canvas>
    </div>
  </section>
  {% endif %}


{% if tem_grafico %}
<script>
  window.graficoLabels = {{ grafico_labels|safe }};
  window.graficoValores = {{ grafico_valores|safe }};
</script>

{% endif %}

<script src="{% static 'core/js/dashboard.js' %}"></script>


{% endblock %}


